apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: dev

# Don't include ../../base as resource (avoid duplicate helmCharts)

labels:
  - pairs:
      environment: dev
      app.kubernetes.io/part-of: my-app
      app.kubernetes.io/managed-by: kustomize
    includeSelectors: false

# Generate resources from local Helm chart with dev values
# chartHome points to parent of chart directory, name is the chart subdirectory
helmGlobals:
  chartHome: ../..

helmCharts:
  - name: base
    releaseName: my-app
    namespace: dev
    valuesFile: values-dev.yaml
    additionalValuesFiles:
      - ../../base/values.yaml

# Dev-specific patches
patches:
  # Single replica for dev
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 1
    target:
      kind: Deployment
      name: my-app

