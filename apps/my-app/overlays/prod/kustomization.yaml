apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: prod

# pdb.yaml needs to be a separate resource (not from base)
resources:
  - pdb.yaml

labels:
  - pairs:
      environment: prod
      app.kubernetes.io/part-of: my-app
      app.kubernetes.io/managed-by: kustomize
    includeSelectors: false

helmGlobals:
  chartHome: ../..

helmCharts:
  - name: base
    releaseName: my-app
    namespace: prod
    valuesFile: ../../base/values.yaml
    additionalValuesFiles:
      - values-prod.yaml

# Production-specific patches
patches:
  # Multiple replicas for production
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 3
    target:
      kind: Deployment
      name: my-app
  
  # Add pod anti-affinity for HA
  - path: patches/deployment-ha.yaml
