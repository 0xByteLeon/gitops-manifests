apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
  - namespace.yaml
  # ArgoCD official installation manifest
  - https://raw.githubusercontent.com/argoproj/argo-cd/v3.2.3/manifests/install.yaml

# Common labels for all resources
labels:
  - pairs:
      app.kubernetes.io/managed-by: kustomize
    includeSelectors: true

# ConfigMap generator for ArgoCD configuration
configMapGenerator:
  - name: argocd-cm
    behavior: merge
    literals:
      # Resource tracking method (annotation is default in v3.x)
      - application.resourceTrackingMethod=annotation
      # Server-side diff for better performance in v3.x
      - server.diff.enabled=true
      - resource.exclusions=""
      - resource.inclusions=""
      # Enable Helm support for Kustomize builds
      - kustomize.buildOptions=--enable-helm

# Patches to customize ArgoCD
patches:
  # Enable status badge
  - patch: |-
      - op: add
        path: /data/statusbadge.enabled
        value: "true"
    target:
      kind: ConfigMap
      name: argocd-cm

